<?php $objectManager = \Magento\Framework\App\ObjectManager::getInstance(); $customerSession = $objectManager->create('Magento\Customer\Model\Session'); if ($customerSession->isLoggedIn()) { $customerId = $customerSession->getCustomerId(); } else { $customerId = "1"; } $connection = $objectManager->get('Magento\Framework\App\ResourceConnection')->getConnection('\Magento\Framework\App\ResourceConnection::DEFAULT_CONNECTION'); $result1 = $connection->fetchAll("SELECT entity_id, firstname, street, city, region, postcode, telephone FROM customer_address_entity WHERE parent_id = '" . $customerId . "'"); $formattedAddresses = ''; $firstAddress = true; foreach ($result1 as $address) { $checked = $firstAddress ? 'checked' : ''; $formattedAddresses .= '<input type="radio" name="address_entity" value="' . $address['entity_id'] . '">' . "\n"; $formattedAddresses .= '<b>'; $formattedAddresses .= $address['firstname'] . ",\n"; $formattedAddresses .= '</b>'; $formattedAddresses .= $address['street'] . ",\n"; $formattedAddresses .= $address['city'] . ",\n"; $formattedAddresses .= $address['region'] . ",\n"; $formattedAddresses .= $address['postcode'] . ".\n"; $formattedAddresses .= $address['telephone'] . ".\n <br>"; $formattedAddresses .= '<hr><br>'; $firstAddress = false; } ?> <form class="form customform" action="<?php echo $block->getBaseUrl() . 'prescription/index/save'; ?>" id="magelearn-customform-form" method="post" data-hasrequired="<?= $block->escapeHtmlAttr(__('* Required Fields')) ?>" enctype="multipart/form-data" data-mage-init='{"validation":{}}' onsubmit="return submitForm()"><div class="progress"><div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div></div><div class="step-titles"><div class="step-title active" data-step="1">Upload Prescription</div><div class="step-line"></div><div class="step-title" data-step="2">Delivery Address</div><div class="step-line"></div><div class="step-title" data-step="3">Payment</div></div><fieldset class="fieldset step" data-step="1"><div class="upload-now"><div class="container prescription"><div class="row"><div class="col single-col"><p class="prescription-head">Upload Prescription</p><p class="prescription-subhead">Please upload your valid prescription</p><div style="display: none;" class="field message required"><label class="label " for="order_id"><span><?= $block->escapeHtml(__('order_id:')) ?></span></label> <div class="control"><?php $objectManager = \Magento\Framework\App\ObjectManager::getInstance(); $connection = $objectManager->get('Magento\Framework\App\ResourceConnection')->getConnection('\Magento\Framework\App\ResourceConnection::DEFAULT_CONNECTION'); $result1 = $connection->fetchAll("SELECT order_id FROM quick_order order by id desc limit 1 "); foreach ($result1 as $row) { echo $id = $row['order_id']; ?> <input name="order_id" value="<?php echo $id + 1 ?>" id="order_id" title="<?= $block->escapeHtml(__('order_id')) ?>" class="input-text" type="text" data-validate="{required:true, 'validate-number':true}" /><?php } ?></div></div><div style="display: none;" class="field message required"><label class="label " for="customer_id"><span><?= $block->escapeHtml(__('customer_id:')) ?></span></label> <div class="control"><input name="customer_id" value="<?php echo $customerId ?>" id="customer_id" title="<?= $block->escapeHtml(__('customer_id')) ?>" class="input-text" type="text" data-validate="{required:true, 'validate-number':true}" /></div></div><div class="field image image-upload"><div id="image-preview-container"></div><label class="label" id="prescription-label" onclick="checkAndAddFileInput()"><img src="http://local.medizinhub.com/media/wysiwyg/Upload_prescription_past.png" alt="" style="width: 92%; height: 188px;"></label> <script>
                                sessionStorage.setItem('Userlogin', 'true');

                                function checkAndAddFileInput() {
                                    var userCheck = sessionStorage.getItem('Userlogin');
                                    if (userCheck === 'true') {
                                        addFileInput();
                                    } else {
                                        var linkRegister = document.createElement('a');
                                        linkRegister.className = 'customer-register-link';
                                        document.body.appendChild(linkRegister);
                                        linkRegister.click();
                                    }
                                }</script><label class="label" id="add-more-prescription" style="display: none;" onclick="addFileInput()"><img src="<?= $block->getViewFileUrl('Magelearn_Customform::images/Upload-new.png') ?>" alt="" style="width: 100%; height: 50px;"></label> <div id="error-message" style="color: red;"></div><div id="file-count-info" style="margin-top: 10px;"></div></div><p class="notes" id="prescription-format">Supported File Format <span>JPG, JPEG, PNG & PDF.<span></p><p class="note" id="prescription-ref">Note: Prescription should be clear & within 5MB.</p></div><div class="col prescription-ref prescription-column" id="prescription-ref"><div class="vertical-line"></div></div><div class="col prescription-ref" id="prescription-ref"><img src="http://local.medizinhub.com/media/wysiwyg/Group_46.png" alt=""><p>Government regulations require a valid prescription</p></div></div></div></div></fieldset><fieldset class="fieldset step" data-step="2"><div class="upload-now-addr"><?php if (!empty($formattedAddresses)) { ?> <div id="existing-addresses-container"><div id="edit-address-form"><div class="prescription-lable-page"><label class="prescription-lable"><?= $block->escapeHtml(__('Delivery Address')) ?></label></div><div class="address-container"><?= $formattedAddresses ?></div><button type=" button" class="action submit primary" id="modal-btn" style="margin: 0 137px"><span>+ Add New Address</span></button></div></div><div id="modal-content" style="display: none;"><div class="container prescription-addr" id="prescription-addr"><div class="prescription-lable-page"><label class="prescription-lable"><?= $block->escapeHtml(__('Add New Delivery Address')) ?></label></div><div class="field customer_name required"><label class="label customer_name prescription-form-label" for="customer_name"><span><?= $block->escapeHtml(__('Full Name*')) ?></span></label> <div class="control address-input"><input name="customer_name" id="customer_name" title="<?= $block->escapeHtmlAttr(__('Full Name')) ?>" class="address-input-text" type="text" required /></div></div><div class="field house_no required"><label class="label house_no prescription-form-label" for="street"><span><?= $block->escapeHtml(__('Flat, House no*')) ?></span></label> <div class="control address-input"><input name="house_no" id="house_no" title="<?= $block->escapeHtmlAttr(__('Flat, House no*')) ?>" class="address-input-text" type="text" required /></div></div><div class="field street required"><label class="label street prescription-form-label" for="street"><span><?= $block->escapeHtml(__('Street Address*')) ?></span></label> <div class="control address-input"><input name="street" id="street" title="<?= $block->escapeHtmlAttr(__('Street Address')) ?>" class="address-input-text" type="text" required /></div></div><div class="row"><div class="col-md-6"><div class="field city required"><label class="label city prescription-form-label" for="city"><span><?= $block->escapeHtml(__('City*')) ?></span></label> <div class="control address-input"><input name="city" id="city" title="<?= $block->escapeHtmlAttr(__('City')) ?>" class="address-input-text" type="text" required /></div></div></div><div class="col-md-6"><div class="field region required"><label class="label region prescription-form-label" for="region"><span><?= $block->escapeHtml(__('State*')) ?></span></label> <div class="control address-input"><input name="region" value="Tamil Nadu" id="region" class="address-input-text" type="text" required /></div></div></div></div><div class="row"><div class="col-md-6"><div class="field postcode required"><label class="label postcode prescription-form-label" for="postcode"><span><?= $block->escapeHtml(__('Pincode*')) ?></span></label> <div class="control address-input"><input name="postcode" id="postcode" title="<?= $block->escapeHtmlAttr(__('Pincode')) ?>" class="address-input-text" type="text" required /></div></div></div><div class="col-md-6"><div class="field Landmark required"><label class="label landmark prescription-form-label" for="landmark"><span><?= $block->escapeHtml(__('Landmark')) ?></span></label> <div class="control address-input"><input name="landmark" id="landmark" class="address-input-text" type="text" required /></div></div></div></div><div class="field telephone required"><label class="label telephone prescription-form-label" for="telephone"><span><?= $block->escapeHtml(__('Phone Number*')) ?></span></label> <div class="control address-input"><input name="telephone" id="telephone" title="<?= $block->escapeHtmlAttr(__('Phone Number')) ?>" class="address-input-text" type="tel" required /></div></div><div class="field region_id required" style="display:none;"><label class="label region_id prescription-form-label" for="region_id"></label> <div class="control address-input"><input name="region_id" value="563" id="region_id" class="input-text" type="text" required /></div></div><div class="field country_id required" style="display:none;"><label class="label country_id prescription-form-label" for="country_id"></label> <div class="control address-input"><input name="country_id" value="IN" id="country_id" class="input-text" type="text" required /></div></div><div class="field status required" style="display:none;"><label class="label status prescription-form-label" for="status"></label> <div class="control address-input"><input name="status" value="1" id="status" class="status" type="text" required /></div></div></div></div><div class="primary" style="display:none;"><button type="button" class="action submit primary" id="address-next-btn">Add Address</button></div><?php } else { ?> <div class="container prescription-addr" id="prescription-addr"><div class="prescription-lable-page"><label class="prescription-lable"><?= $block->escapeHtml(__('Add New Delivery Address')) ?></label></div><div class="field customer_name required"><label class="label customer_name prescription-form-label" for="customer_name"><span><?= $block->escapeHtml(__('Full Name*')) ?></span></label> <div class="control address-input"><input name="customer_name" id="customer_name" title="<?= $block->escapeHtmlAttr(__('Full Name')) ?>" class="address-input-text" type="text" required /></div></div><div class="field house_no required"><label class="label house_no prescription-form-label" for="street"><span><?= $block->escapeHtml(__('Flat, House no*')) ?></span></label> <div class="control address-input"><input name="house_no" id="house_no" title="<?= $block->escapeHtmlAttr(__('Flat, House no*')) ?>" class="address-input-text" type="text" required /></div></div><div class="field street required"><label class="label street prescription-form-label" for="street"><span><?= $block->escapeHtml(__('Street Address*')) ?></span></label> <div class="control address-input"><input name="street" id="street" title="<?= $block->escapeHtmlAttr(__('Street Address')) ?>" class="address-input-text" type="text" required /></div></div><div class="row"><div class="col-md-6"><div class="field city required"><label class="label city prescription-form-label" for="city"><span><?= $block->escapeHtml(__('City*')) ?></span></label> <div class="control address-input"><input name="city" id="city" title="<?= $block->escapeHtmlAttr(__('City')) ?>" class="address-input-text" type="text" required /></div></div></div><div class="col-md-6"><div class="field region required"><label class="label region prescription-form-label" for="region"><span><?= $block->escapeHtml(__('State*')) ?></span></label> <div class="control address-input"><input name="region" value="Tamil Nadu" id="region" class="address-input-text" type="text" required /></div></div></div></div><div class="row"><div class="col-md-6"><div class="field postcode required"><label class="label postcode prescription-form-label" for="postcode"><span><?= $block->escapeHtml(__('Pincode*')) ?></span></label> <div class="control address-input"><input name="postcode" id="postcode" title="<?= $block->escapeHtmlAttr(__('Pincode')) ?>" class="address-input-text" type="text" required /></div></div></div><div class="col-md-6"><div class="field Landmark required"><label class="label landmark prescription-form-label" for="landmark"><span><?= $block->escapeHtml(__('Landmark')) ?></span></label> <div class="control address-input"><input name="landmark" id="landmark" class="address-input-text" type="text" required /></div></div></div></div><div class="field telephone required"><label class="label telephone prescription-form-label" for="telephone"><span><?= $block->escapeHtml(__('Phone Number*')) ?></span></label> <div class="control address-input"><input name="telephone" id="telephone" title="<?= $block->escapeHtmlAttr(__('Phone Number')) ?>" class="address-input-text" type="tel" required /></div></div><div class="field region_id required" style="display:none;"><label class="label region_id prescription-form-label" for="region_id"></label> <div class="control address-input"><input name="region_id" value="563" id="region_id" class="input-text" type="text" required /></div></div><div class="field country_id required" style="display:none;"><label class="label country_id prescription-form-label" for="country_id"></label> <div class="control address-input"><input name="country_id" value="IN" id="country_id" class="input-text" type="text" required /></div></div><div class="field status required" style="display:none;"><label class="label status prescription-form-label" for="status"></label> <div class="control address-input"><input name="status" value="1" id="status" class="status" type="text" required /></div></div></div><div class="primary" style="display:none;"><button type="button" class="action submit primary" id="address-next-btn">Add Address</button></div><?php } ?></div></fieldset><fieldset class="fieldset step" data-step="3"><div class="prescription-lable-page"><label class="prescription-lable"><?= $block->escapeHtml(__('Payment Method')) ?></label></div><div class="upload-now-addr"><div class="container prescription-addr" id="prescription-payment"><div class=" field payment-method"><div class="control"><div class="radio-option"><input type="radio" id="payment-method-cash" name="payment-method" value="cash_on_delivery" checked><label for="payment-method-cash"><?= $block->escapeHtml(__('Cash on Delivery')) ?></label></div></div></div></div></div></fieldset><div class="actions-toolbars upload-button" style="width:100%; text-align:center;"><div class="primary" id="existing-addresses-container"><button type="button" class="action submit primary " id="prev-btn" style="display:none;"><span>Previous</span></button> <button type="button" class="action submit primary btn-navigate-form-step" id="next-step-btn"><span>Continue</span></button> <button id="pre-btn" type="submit" title="<?= $block->escapeHtmlAttr(__('Submit')) ?>" class="action submit primary pre-btn" onclick="submitForm()"><span><?= $block->escapeHtml(__('PLACE ORDER')) ?></span></button></div></div></form><style> .address-container { width: 100%; background-color: rgb(233, 246, 253); padding: 40px; margin-bottom: 20px; border: 1px solid rgb(108, 82, 82); border-radius: 8px; margin-left: -25px; } .prescription-form-label { font-family: 'Source Sans Pro'; font-weight: 600; font-size: 16px; } .file-input-container { margin: -18px 0 13px 0; } .address-input { padding: 10px 0; } .address-input-text { border: 2px solid #BCE9D6 !important; border-radius: 4px !important; } .step-title:not(:last-child) { margin-right: 10px; } .step-line { width: 77px; border-top: 2px solid #ccc; flex-grow: 0; margin-top: 14px; } .step-titles { display: flex; justify-content: space-between; margin-bottom: 30px; margin-top: 12px; width: 88%; margin-left: 67px; } .step-title { font-family: Source Sans Pro; position: relative; flex-grow: 1; text-align: center; color: #999; font-size: 18px; padding-bottom: 5px; cursor: pointer; } .step-title.active { font-family: Source Sans Pro; color: #333; font-weight: bold; } .step-title::before { content: ''; position: absolute; top: 42%; left: 60px; width: 20px; height: 20px; border-radius: 50%; transform: translateY(-50%); } .step-title.active::before, .step-title.complete::before { content: '✔'; color: #fff; background-color: #5ABB7C; font-size: 10px; line-height: 20px; text-align: center; border-radius: 50%; }</style><script>
    require([
        'jquery'
    ], function($) {
        $(document).ready(function() {
            $('#next-step-btn').click(function() {
                var houseNo = $('#house_no').val();
                var street = $('#street').val();
                var landmark = $('#landmark').val();
                var fullAddress = houseNo + ', ' + street + ', ' + landmark;
                $('#street').val(fullAddress);
                $('#house_no').val('');
                $('#landmark').val('');
            });
        });
    });
  

    document.addEventListener('DOMContentLoaded', function() {
        const modalBtn = document.getElementById('modal-btn');
        const modalContent = document.getElementById('modal-content');
        const existingAddressesContainer = document.getElementById('existing-addresses-container');

        modalBtn.addEventListener('click', function() {
            existingAddressesContainer.style.display = 'none';
            if (modalContent.style.display === 'none') {
                modalContent.style.display = 'block';
            } else {
                modalContent.style.display = 'none';
            }
        });
    });
    document.addEventListener("DOMContentLoaded", function() {
        const form = document.getElementById('magelearn-customform-form');
        const addAddressBtn = document.getElementById('address-next-btn');
        const steps = form.querySelectorAll('.step');
        const stepTitles = document.querySelectorAll('.step-title');
        const nextBtn = document.getElementById('next-step-btn');
        const prevBtn = document.getElementById('prev-btn');
        const submitBtn = document.getElementById('pre-btn');
        const modalPtn = document.getElementById('modal-btn');
        let currentStep = 0;
        nextBtn.disabled = true;

        function showStep(stepIndex) {
            const progressBar = document.querySelector('.progress-bar');
            const progress = ((stepIndex + 1) / steps.length) * 100;
            progressBar.style.width = progress + '%';
            progressBar.setAttribute('aria-valuenow', progress);

            stepTitles.forEach((stepTitle, index) => {
                if (index === stepIndex) {
                    stepTitle.classList.add('active');
                }
            });

            steps.forEach((step, index) => {
                if (index === stepIndex) {
                    step.style.display = 'block';
                } else {
                    step.style.display = 'none';
                }
            });
            if (stepIndex === 0) {
                prevBtn.style.display = 'none';
            } else {
                prevBtn.style.display = 'none';
            }
            if (stepIndex === steps.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'inline-block';
            } else {
                nextBtn.style.display = 'inline-block';
                submitBtn.style.display = 'none';
            }
        }

        function goToNextStep() {
            var fileInputs = document.getElementsByName('image[]');
            var errorMessage = document.getElementById('error-message');
            var atLeastOneFileSelected = false;
            for (var i = 0; i < fileInputs.length; i++) {
                if (fileInputs[i].files.length > 0) {
                    atLeastOneFileSelected = true;
                    break;
                }
            }
            if (!atLeastOneFileSelected) {
                errorMessage.textContent = 'Please upload your prescription.';
                errorMessage.style.display = 'inline-block';
            } else {
                errorMessage.textContent = '';
                errorMessage.style.display = 'none';
                if (currentStep < steps.length - 1) {
                    currentStep++;
                    showStep(currentStep);
                }
            }
            nextBtn.disabled = !atLeastOneFileSelected;
        }

        function goToPrevStep() {
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function goToStep(stepIndex) {
            currentStep--;
            if (currentStep < 0) {
                currentStep = 0;
            }
            showStep(currentStep);
        }

        addAddressBtn.addEventListener('click', function() {
            goToNextStep();
        });

        stepTitles.forEach((stepTitle, index) => {
            stepTitle.addEventListener('click', () => {
                goToStep(index);
            });
        });

        nextBtn.addEventListener('click', goToNextStep);
        prevBtn.addEventListener('click', goToPrevStep);

        function validateInput(input, errorMessageId, pattern, errorMessage) {
            const value = input.value.trim();
            const errorMessageElement = document.getElementById(errorMessageId);
            if (!value.match(pattern)) {
                errorMessageElement.textContent = errorMessage;
                input.classList.add('error');
            } else {
                document.getElementById('address-error-message').style.display = 'none';
                errorMessageElement.textContent = '';
                input.classList.remove('error');
            }
        }

        function validateStep(stepIndex) {
            let isValid = true;
            const fields = steps[stepIndex].querySelectorAll('input.required, select.required');
            fields.forEach(field => {
                if (field.value.trim() === '') {
                    isValid = false;
                    field.classList.add('error');
                } else {
                    field.classList.remove('error');
                }
            });
            if (stepIndex === 1) {
                const fullName = document.getElementById('customer_name').value.trim();
                const mobile = document.getElementById('mobile').value.trim();
                const streetAddress = document.getElementById('street_address').value.trim();
                const city = document.getElementById('city').value.trim();
                const pinNumber = document.getElementById('pin_code').value.trim();

                if (fullName === '' || mobile === '' || streetAddress === '' || city === '' || pinNumber === '') {
                    isValid = false;
                    document.getElementById('address-error-message').textContent = 'Please fill out all address fields.';
                    document.getElementById('address-error-message').style.display = 'inline-block';
                } else {
                    document.getElementById('address-error-message').textContent = '';
                    document.getElementById('address-error-message').style.display = 'none';
                }
            }
            return isValid;
        }

        document.getElementById("magelearn-customform-form").addEventListener("submit", function(event) {
            if (!validateStep(currentStep)) {
                event.preventDefault();
                return false;
            }
            document.getElementById("pre-btn").setAttribute("disabled", "true");
        });

        showStep(currentStep);
    });

    const errorMessage = document.getElementById('error-message');
    var maxFileInputs = 5;
    var maxSizeMB = 5;
    var previewFileCount = 0;

    function addFileInput() {
        if (previewFileCount >= maxFileInputs) {
            var fileUploadLimit = document.getElementById('error-message');
            fileUploadLimit.textContent = "You can only upload up to 5 files.";
            fileUploadLimit.style.display = 'inline-block';
            document.getElementById('add-more-prescription').style.display = 'none';
            return;
        } else {
            var fileUploadLimit = document.getElementById('error-message');
            fileUploadLimit.textContent = "";
            fileUploadLimit.style.display = 'none';
        }

        var container = document.getElementById('image-preview-container');
        var newInputContainer = document.createElement('div');
        newInputContainer.className = 'file-input-container';

        var newInput = document.createElement('input');
        newInput.type = 'file';
        newInput.name = 'image[]';
        newInput.accept = '.jpeg, .jpg, .png, .gif, .pdf';
        newInput.id = 'image-pre';
        newInput.style.display = 'none';
        newInput.multiple = true;
        newInput.onchange = function() {
            fileSelected(this, newInputContainer);
        };

        var previewImage = document.createElement('img');
        previewImage.className = 'preview-image';

        var removeButton = document.createElement('a');
        removeButton.className = 'remove-button';
        removeButton.textContent = 'x';
        removeButton.style.display = 'none';
        removeButton.onclick = function() {
            removeFileInput(newInputContainer);
        };

        newInputContainer.appendChild(newInput);
        newInputContainer.appendChild(previewImage);
        newInputContainer.appendChild(removeButton);
        container.appendChild(newInputContainer);

        simulateClick(newInput);
    }

    function simulateClick(element) {
        var event = new MouseEvent('click', {
            bubbles: true,
            cancelable: false,
            view: window
        });
        element.dispatchEvent(event);
    }

    function fileSelected(input, container) {
        input.style.display = 'none';
        var removeButton = container.querySelector('.remove-button');
        removeButton.style.display = 'none';

        var files = input.files;
        for (var i = 0; i < files.length; i++) {
            var file = files[i];
            if (file.size <= 5 * 1024 * 1024) {
                var removeButton = container.querySelector('.remove-button');
                removeButton.style.display = 'inline-block';
                if (previewFileCount < maxFileInputs) {
                    var previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    container.appendChild(previewItem);
                    const fileReader = new FileReader();
                    fileReader.onload = function(e) {
                        if (file.type.startsWith('image/')) {
                            const image = document.createElement('img');
                            image.src = e.target.result;
                            image.style.width = '100px';
                            image.style.height = '100px';
                            previewItem.appendChild(image);
                        } else if (file.type === 'application/pdf') {
                            const pdfIcon = document.createElement('img');
                            pdfIcon.src = "<?= $block->getViewFileUrl('Magelearn_Customform::images/pdf.png') ?>";
                            pdfIcon.style.width = '100px';
                            pdfIcon.style.height = '100px';
                            previewItem.appendChild(pdfIcon);
                        }
                        const nextBtn = document.getElementById('next-step-btn');
                        nextBtn.disabled = false;
                        document.getElementById("pre-btn").removeAttribute("disabled");
                        document.getElementById('prescription-label').style.display = 'none';
                        document.getElementById('add-more-prescription').style.display = 'inline-block'
                        previewFileCount++;
                    };
                    fileReader.readAsDataURL(file);
                } else {
                    var fileUploadLimit = document.getElementById('error-message');
                    fileUploadLimit.textContent = "You can only upload up to 5 files.";
                    fileUploadLimit.style.display = 'inline-block';
                    document.getElementById('add-more-prescription').style.display = 'none';
                    return;
                }
            } else {
                container.remove();
                previewFileCount--;
                const nextBtn = document.getElementById('next-step-btn');
                nextBtn.disabled = true;
                var fileSizeLimits = document.getElementById('error-message');
                fileSizeLimits.textContent = "File size exceeds 5 MB.";
                fileSizeLimits.style.display = 'inline-block';
                return;
            }
        }
    }

    function removeFileInput(container) {
        container.remove();
        previewFileCount--;
        var addButton = document.getElementById('add-more-prescription');
        addButton.style.display = 'inline-block';
        const totalImageCount = document.getElementById('image-preview-container').getElementsByTagName('img').length;
        if ((previewFileCount === 0) || (totalImageCount === 0)) {
            var fileSizeLimit = document.getElementById('error-message');
            fileSizeLimit.textContent = "Please upload your prescription";
            fileSizeLimit.style.display = 'inline-block';
            document.getElementById('prescription-label').style.display = 'inline-block';
            document.getElementById('add-more-prescription').style.display = 'none';
            const nextBtn = document.getElementById('next-step-btn');
            nextBtn.disabled = true;
        } else {
            const nextBtn = document.getElementById('next-step-btn');
            nextBtn.disabled = false;
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('prescription-label').style.display = 'none';
            document.getElementById('add-more-prescription').style.display = 'inline-block';
        }
    }

    function submitForm() {
        var fileInputs = document.getElementsByName('image[]');
        var validSize = true;
        for (var i = 0; i < fileInputs.length; i++) {
            var files = fileInputs[i].files;
            for (var j = 0; j < files.length; j++) {
                var file = files[j];
                if (file.size > maxSizeMB * 1024 * 1024) {
                    validSize = false;
                    alert('File size exceeds the limit of ' + maxSizeMB + 'MB.');
                    break;
                }

                var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf'];
                if (allowedTypes.indexOf(file.type) === -1) {
                    validSize = false;
                    alert('Unsupported file type. Please upload JPEG, JPG, PNG, GIF, or PDF files.');
                    break;
                }
            }
            if (!validSize) {
                break;
            }
        }
    }</script>